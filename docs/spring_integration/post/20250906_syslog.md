# Spring Integration
## [Syslog](https://docs.spring.io/spring-integration/reference/syslog.html) 지원


Syslog 지원

Spring Integration 2.2부터 SyslogToMapTransformer라는 syslog 변환기가 도입되었습니다.

의존성 추가

프로젝트에 아래와 같은 의존성을 포함해야 합니다:

Maven

<dependency>
    <groupId>org.springframework.integration</groupId>
    <artifactId>spring-integration-syslog</artifactId>
    <version>6.5.1</version>
</dependency>


이 변환기는 UDP 또는 TCP 인바운드 어댑터와 함께 사용하여 다른 호스트에서 syslog 레코드를 수신하고 분석할 수 있습니다. 변환기는 syslog 메시지의 요소들을 포함하는 Map을 메시지 payload로 생성합니다.

Spring Integration 3.0부터는 하나의 XML 요소로 syslog 인바운드 어댑터를 손쉽게 설정할 수 있는 namespace 지원이 추가되었습니다.

버전 4.1.1부터는 RFC 5424에 정의된 확장 syslog 포맷이 지원됩니다. 추가적으로, TCP와 RFC5424를 사용할 때는 RFC 6587에 정의된 옥텟 카운팅 방식과 비투명(non-transparent) 프레이밍도 지원합니다.

Syslog 인바운드 채널 어댑터

이 요소는 UDP 또는 TCP 인바운드 채널 어댑터와 MessageConverter를 포함하며, syslog 메시지를 Spring Integration 메시지로 변환합니다.

DefaultMessageConverter는 SyslogToMapTransformer에 위임하여 syslog 필드를 Map 형태로 payload에 담은 메시지를 생성합니다.

메시지를 제외한 모든 필드는 메시지 헤더로도 제공되며 syslog_ 접두어가 붙습니다.

이 모드에서는 **RFC 3164 (BSD syslog)**만 지원됩니다.

버전 4.1부터 DefaultMessageConverter에는 asMap이라는 속성이 생겼습니다.

기본값은 true → 변환 결과를 Map으로 payload에 저장

false일 경우 → 원본 syslog 메시지를 byte[] 그대로 payload에 담고, 해석된 필드는 헤더로 설정

버전 4.1.1부터는 RFC5424MessageConverter를 사용해 RFC 5424도 지원합니다.

이 경우, asMap=false일 때만 필드가 헤더로 복사됩니다.

TCP 전송 + RFC 5424를 사용할 경우, RFC 6587에서 정의된 다양한 프레이밍 기법을 활성화하기 위한 추가 설정이 필요합니다.

어댑터에는 RFC6587SyslogDeserializer로 구성된 TCP 연결 팩토리를 제공해야 합니다.

기본적으로 이 Deserializer는 옥텟 카운팅과 **비투명 프레이밍(linefeed(LF) 구분)**을 처리합니다.

옥텟 카운팅이 감지되지 않으면 ByteArrayLfSerializer를 사용합니다.

다른 비투명 프레이밍을 원한다면 별도의 Deserializer를 제공할 수 있습니다.

단, asMap=false인 경우에는 RFC6587SyslogDeserializer 생성자에 retainOriginal을 지정해야 합니다.

예제 설정
UDP 어댑터 (채널 syslogIn으로 메시지 전송)
<int-syslog:inbound-channel-adapter id="syslogIn" port="1514" />

UDP 어댑터 (채널 fromSyslog으로 메시지 전송)
<int-syslog:inbound-channel-adapter id="syslogIn"
    channel="fromSyslog" port="1514" />

TCP 어댑터 (채널 syslogIn으로 메시지 전송)
<int-syslog:inbound-channel-adapter id="bar" protocol="tcp" port="1514" />


👉 protocol 속성을 추가할 수 있으며 기본값은 udp입니다.

UDP 어댑터 (세부 설정 포함)
<int-syslog:inbound-channel-adapter id="udpSyslog"
    channel="fromSyslog"
    auto-startup="false"
    phase="10000"
    converter="converter"
    send-timeout="1000"
    error-channel="errors">
        <int-syslog:udp-attributes port="1514" lookup-host="false" />
</int-syslog:inbound-channel-adapter>


auto-startup, phase → SmartLifecycle 속성

converter → 커스텀 MessageConverter 참조

error-channel → 오류 채널 지정

udp-attributes → UDP 관련 속성 지정 (포트는 여기서 설정해야 함)

TCP 어댑터 (외부 connection-factory 참조)
<int-syslog:inbound-channel-adapter id="TcpSyslog"
    protocol="tcp"
    channel="fromSyslog"
    connection-factory="cf" />

<int-ip:tcp-connection-factory id="cf" type="server" port="1514" />


connection-factory는 server 타입이어야 하며, 포트는 팩토리에서 정의합니다.

TCP 어댑터 + RFC 5424 + RFC 6587 설정
<int-syslog:inbound-channel-adapter id="rfc5424Tcp"
    protocol="tcp"
    channel="fromSyslog"
    connection-factory="cf"
    converter="rfc5424" />

<int-ip:tcp-connection-factory id="cf"
    using-nio="true"
    type="server"
    port="1514"
    deserializer="rfc6587" />

<bean id="rfc5424" class="org.springframework.integration.syslog.RFC5424MessageConverter" />
<bean id="rfc6587" class="org.springframework.integration.syslog.inbound.RFC6587SyslogDeserializer" />


👉 RFC 5424 변환기와 RFC 6587 Deserializer를 함께 사용하도록 구성된 예제입니다.

원문이 워낙 길어서 기술 문서 톤으로 정리했는데, 혹시 제가 이걸 XML 설정만 별도로 모아서 예제집 형태로 다시 정리해드릴까요?